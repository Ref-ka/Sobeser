# Sobeser

Консольная мультиагентная система для проведения технического интервью.

## На чем работает

Для реализации агентов используется LangChain, для построения связей между агентами используется граф из LangGraph.

### Роли (агенты)

- **Planner** (`nodes/planner_node.py`)
  - Составляет план интервью, основываясь на данных кандидата.
- **Observer** (`nodes/observer_node.py`)
  - Анализирует последний ответ кандидата.
  - Решает, завершать интервью или продолжать.
  - Регулирует сложность вопросов.
- **Interviewer** (`nodes/interviewer_node.py`)
  - Генерирует следующий вопрос кандидату, опираясь на:
    - план интервью,
    - текущую сложность,
    - последнюю оценку Observer,
    - последние сообщения диалога.
  - Именно его текст показывается пользователю.
- **Manager** (`nodes/manager_node.py`)
  - Формирует финальный структурированный фидбэк.
  - Перед генерацией суммаризирует мысли Observer.
  - Опционально может использовать веб-поиск Tavily для подбора ресурсов.

## Требования

- Проект разрабатывался в окружении Python 3.12
- Зависимости из `requirements.txt`
- Ключ(и) API:
  - **обязательно**: `VSEGPT_API_KEY`
  - **опционально**: `TAVILY_API_KEY` (если хотите, чтобы Manager подбирал ссылки через веб-поиск)

## Установка

1) Создайте и активируйте виртуальное окружение.

2) Установите зависимости:

```bash
pip install -r requirements.txt
```

## Настройка окружения (.env)

В проекте используется `python-dotenv`: переменные автоматически подхватываются из файла `.env` в корне.

Создайте `.env` рядом с `main.py`:

```env
VSEGPT_API_KEY=ваш_ключ_vsegpt
TAVILY_API_KEY=ваш_ключ_tavily
```

## Запуск

```bash
python main.py
```

Дальше:

- введите профиль кандидата (или нажимайте Enter, чтобы оставить значения по умолчанию);
- дождитесь первого вопроса;
- вводите ответы, завершайте ввод строкой `--stop--`.

## Управление интервью

- **Чтобы завершить интервью и получить фидбэк:**
  - в любом ответе напишите одно из ключевых слов/фраз:
    - `стоп`, `фидбэк`, `стоп интервью`, `давай фидбэк`, `закончи`, и т.п.
  - `Observer` может сам распознать требование к окончанию.

## Логи

После завершения сессии сохраняются файлы в `./logs/`:

- `interview_log_YYYY-MM-DD_HH-MM-SS.json`
  - `turns[]` содержит:
    - `agent_visible_message` — что говорил интервьюер,
    - `user_message` — ответ кандидата,
    - `internal_thoughts` — внутренние сообщения/оценки агентов (скрытая рефлексия).
  - `final_feedback` — финальный отчёт Manager.
- `runtime_traces.jsonl`
  - построчные JSON-события по выполнению узлов (`planner/observer/interviewer/manager`), длительности и ошибкам.

## Структура проекта

- `main.py` — CLI-приложение и цикл диалога.
- `interview_engine.py` — создание агентов, сборка графа LangGraph, обработка ввода, логирование.
- `nodes/` — узлы графа:
  - `planner_node.py`
  - `observer_node.py`
  - `interviewer_node.py`
  - `manager_node.py`
- `prompts.py` — системные промпты ролей.
- `routing.py` — условия переходов между узлами.
- `state.py` — схема состояния `AgentState`.
- `logger.py` — сохранение логов сессии и runtime-трейсов.
- `summarizer.py` — суммаризация мыслей Observer перед финальным фидбэком.
